---
editor_options:
  chunk_output_type: console
output:
  html_document: 
    toc: true
    toc_depth: 4
    toc_float: true
    code_folding: 'hide'
    self_contained: true
---

# Initial elevation bias in subjective reports 
Replicating and extending [Shrout et al. (2017)](http://www.pnas.org/content/early/2017/12/12/1712277115.full).

__Authors__: [Ruben C. Arslan](https://www.mpib-berlin.mpg.de/en/staff/ruben-arslan), Julie Driebe, Tanja Gerlach, & Lars Penke.

```{r}
source("routine_and_sex/0_helpers.R")
opts_chunk$set(warning = F, message = F, error = TRUE, fig.width = 13, fig.height = 10)
load("routine_and_sex/cleaned.rdata")
library(broom.mixed)
options(width = 4000)
```

```{r}
diary = diary %>% 
  group_by(session) %>% 
  mutate(day_number = round(as.numeric(created_diary - min(created_diary), unit = 'days')))
  
opts_chunk$set(fig.width = 15, fig.height = 8, dev = "CairoPNG")

diary = diary %>% filter(!is.na(ended_diary), day_number >= 0, day_number < 70) %>% 
  group_by(session) %>% 
  mutate(days_done = max(days_done, na.rm = T), 
         didntmissfirstweek = all(1:7 %in% day_number),
         first_day = if_else(day_number == 0, 1, 0))

diary_items <- formr::items(diary) %>% as.data.frame()

if (!file.exists("routine_and_sex/data/s3_daily_id_proc.rds")) {
  s3_daily_id = jsonlite::fromJSON("routine_and_sex/data/s3_daily_itemdisplay.json")
  saveRDS(s3_daily_id, file = "routine_and_sex/data/s3_daily_id.rds")
  s3_daily_id = readRDS(file = "routine_and_sex/data/s3_daily_id.rds")
  s3_daily_id = s3_daily_id  %>% filter(!is.na(session), !session %contains% "XXX") %>%
    mutate(
      session = as.factor(stringr::str_sub(session, 1, 7)),
      created = as.POSIXct(created),
      answered_relative = as.numeric(answered_relative),
      shown_relative = as.numeric(shown_relative),
      display_order = as.numeric(display_order),
      hidden = as.numeric(hidden),
      unit_session_id = as.numeric(unit_session_id),
      saved = as.POSIXct(saved),
      answered = as.POSIXct(answered),
      shown = as.POSIXct(shown),
    ) %>%
    group_by(session) %>%
    mutate(
      day_number = round(as.numeric(created - min(created, na.rm = TRUE), unit = 'days')),
      didntmissfirstweek = all(0:6 %in% day_number),
      first_day = if_else(day_number == 0, 1, 0),
      time_to_response_server = answered - shown,
      time_to_response = answered_relative - shown_relative) %>%
    group_by(session, unit_session_id) %>%
    mutate(day_number = min(day_number, na.rm = TRUE)) %>%
    group_by(session, item_name) %>%
    mutate(
           first_day_of_item = min(day_number[!is.na(answer)]),
           first_day_of_item_factor = factor(if_else(first_day_of_item > 6, "7+", as.character(first_day_of_item))),
           first_day_of_item_shown = first_day_of_item == day_number) %>%
   filter(day_number >= 0, day_number < 70, is.finite(day_number))
  
  s3_daily_id <- s3_daily_id %>% left_join(diary_items %>% rename(item_name = name) %>% select(item_name, label, choices), "item_name")
  saveRDS(s3_daily_id, file = "routine_and_sex/data/s3_daily_id_proc.rds")
} else {
  s3_daily_id = readRDS(file = "routine_and_sex/data/s3_daily_id_proc.rds")
}

s3_daily_id = s3_daily_id %>% 
  group_by(session, unit_session_id) %>% 
  mutate(refer_time_period = answer[item_name == "refer_time_period"][1])
  
first_page = s3_daily_id  %>% filter(!is.na(session), !session %contains% "XXX") %>%
  filter(item_name %in% c("irritable", "self_esteem", "risk_taking", "good_mood", "loneliness", "stressed")) %>% 
  mutate(answer = as.numeric(answer))

labels <- data.frame(item_name = c("irritable", "self_esteem", "risk_taking", "good_mood", "loneliness", "stressed"), label_english = c(
  "I was irritable.",
  "I was satisfied with myself.",
  "I was prepared to take risks.",
  "My mood was good.",
  "I was lonely.",
  "I was stressed."))
first_page <- first_page %>% left_join(labels, by = 'item_name')

first_page = first_page %>% filter(!is.na(displaycount)) %>% 
  group_by(session, unit_session_id) %>% 
  mutate(display_order = min_rank(display_order))

first_page = first_page %>% 
  mutate(first_item_on_first_day = display_order == 1 & first_day,
         number_of_items_shown = n()) %>% 
  arrange(session, unit_session_id, display_order) %>% 
  group_by(session, unit_session_id) %>% 
  mutate(response_time_since_previous = answered_relative - lag(answered_relative))

first_page = first_page %>% 
  group_by(session, item_name) %>% 
  arrange(session, item_name, unit_session_id) %>% 
  mutate(times_item_answered = cumsum(!is.na(answer)))

first_page <- first_page %>% ungroup() %>% mutate(
  times_item_answered_factor = factor(if_else(times_item_answered > 6, "7+", as.character(times_item_answered))),
  day_number_factor = factor(if_else(day_number > 6, "7+", as.character(day_number))),
  refer_time_period = recode(factor(refer_time_period), "in den letzten 24 Stunden" = "last 24 hours", "seit meinem letzten Eintrag" = "last entry")
)

```

## Description
The following items were shown in random order on the first page of our diary. 

- I was stressed. (40% probability of being shown)
- I was lonely. (40%)
- My mood was good. (80%)
- I was prepared to take risks. (20%)
- I was satisfied with myself. (80%)
- I was irritable. (40%)

Participants could answer on a 5 point likert scale from "less than usual" to "more than usual". Pole labels were placed left and right of blank, equally sized buttons.
Because of our planned missing design with randomised display and order, participants saw only a subset of these items each day. Therefore, the following were randomised variables
- the day an item was first shown (conditional on adjusting for day number), 
- the number of times an item was seen previously (conditional as above). 
- the number of items on that day.
- the display order.

We did not randomise the start date of the entire diary.
So, the key difference to Shrout et al. is that we cannot tell apart causal effects of the first day of the diary from e.g. selection effects, but we can disentangle the day people first respond to the diary from the day people first respond to the item, which Shrout et al. could not. 
We can estimate the difference between the first diary day and later days, but this difference might be exacerbated or reduced via selection effects.

We estimate smaller first day of item effects than Shrout et al. report. This may be 

- because the initial elevation bias is concentrated on the diary level (as may be speculated based on our correlative results for loneliness) or 
- because the bias is smaller for our items, sample, and assessment procedure, or 
- because in a slightly ironic turn of events Shrout et al.'s results are suspected to the science version of initial elevation bias, i.e. winner's curse, where the significance filter by publication results in inital overestimates of scientific effects. 

Because of the randomisation, selection should play no role. However, in longitudinal studies and indeed in Shrout et al.'s study and our own, incomplete data is common. If dissatisfied individuals are more likely to discontinue the study, we might also see an initial elevation in dissatisfaction. Therefore, we test all effects both only on people who did not miss a day during the first week and including people who missed days.

> Cohenâ€™s d estimates were obtained by calculating the mean within-subject change and dividing it by the pooled between-subject SD.

Since our between-subject SDs are all around 1 and these biases are likely to be relative to the Likert scale used, we don't do this.

```{r fig.height=10}
theme_set(theme_classic() + theme_pander(base_size = 20))
first_page %>% group_by(label_english) %>% summarise(
  mean = mean(answer, na.rm = T),
  sd = sd(answer, na.rm = T),
  n = n_nonmissing(answer))

first_page %>% ggplot(aes(answer)) + geom_bar() + facet_wrap(~ label_english, nrow = 2, scales = "free_y") +
  scale_x_continuous("Response", breaks = 0:4, labels = c("[0] less\nthan\nusual", 1, 2, 3, "[4] more\nthan\nusual"))
```

## Simple time series
```{r}
ggplot(first_page, aes(day_number, answer)) + 
  geom_pointrange(position = position_dodge(width = 0.2), stat='summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.2), stat='summary', fun.data = 'mean_se') +
  scale_y_continuous("Response", limits = c(0,4)) +
  facet_wrap(~ label_english) +
  ggtitle("Responses over time")

ggplot(first_page, aes(day_number, answer)) + 
  geom_pointrange(position = position_dodge(width = 0.2), stat='summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.2), stat='summary', fun.data = 'mean_se') +
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = "free_y") + 
  ggtitle("Responses over time", subtitle = "free y axes")
```

## Time series by first day item shown {.active}

```{r}
first_page %>% 
  filter(day_number < 7) %>% 
  group_by(item_name) %>% 
  mutate(group_mean = mean(answer, na.rm = TRUE)) %>% 
  group_by(item_name, day_number, first_day_of_item_factor) %>% 
  filter(n_nonmissing(answer) > 20) %>% 
  ggplot(., aes(day_number, answer, colour = first_day_of_item_factor)) + 
  geom_hline(aes(yintercept = group_mean, group = label), color = "gray", linetype = 'dashed') +
  geom_pointrange(position = position_dodge(width = 0.2), stat = 'summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat = 'summary', fun.data = 'mean_se') + 
  scale_color_colorblind("First day the\nitem was shown") +
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = "free_y") + 
  scale_x_continuous("Day number", breaks = 0:10)
```


```{r}
first_page %>% 
  filter(day_number < 11) %>% 
  group_by(item_name) %>% 
  mutate(group_mean = mean(answer, na.rm = TRUE)) %>% 
  group_by(item_name, day_number, first_day_of_item_factor) %>% 
  filter(n_nonmissing(answer) > 20) %>% 
  ggplot(., aes(day_number, answer, colour = first_day_of_item_factor)) + 
  geom_hline(aes(yintercept = group_mean, group = label), color = "gray", linetype = 'dashed') +
  geom_pointrange(position = position_dodge(width = 0.2), stat = 'summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat = 'summary', fun.data = 'mean_se') + 
  scale_color_colorblind("First day the\nitem was shown") +
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = "free_y") + 
  scale_x_continuous("Day number", breaks = 0:10)
```

```{r}
first_page %>% 
  filter(day_number < 11) %>% 
  group_by(item_name) %>% 
  mutate(group_mean = mean(answer, na.rm = TRUE)) %>%
  # group_by(item_name, day_number, first_day_of_item_factor) %>%
  # filter(n_nonmissing(answer) > 20) %>%
  ggplot(., aes(day_number, answer, colour = first_day_of_item_factor)) + 
  geom_hline(aes(yintercept = group_mean, group = label), color = "gray", linetype = 'dashed') +
  geom_pointrange(position = position_dodge(width = 0.2), stat = 'summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat = 'summary', fun.data = 'mean_se') + 
  scale_color_colorblind("First day the\nitem was shown") +
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = "free_y") + 
  scale_x_continuous("Day number", breaks = 0:10) +
  ggtitle("All days", "including combinations with fewer than 20 observations")
```

```{r}
first_page %>% 
  filter(day_number < 11) %>% 
  group_by(item_name) %>% 
  mutate(group_mean = mean(answer, na.rm = TRUE),
         day = if_else(first_day_of_item_shown, if_else(first_day == 1, 
                       "first item, \nfirst day", "first item, \nlater day"), "later day")) %>%
  group_by(item_name, day) %>% 
  filter(n_nonmissing(answer) > 20) %>% 
  ggplot(., aes(day, answer)) + 
  geom_hline(aes(yintercept = group_mean, group = label), color = "gray", linetype = 'dashed') +
  geom_pointrange(position = position_dodge(width = 0.2), stat = 'summary', fun.data = 'mean_se') + 
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = "free_y")
```

```{r}
first_page %>% 
  filter(day_number < 11) %>% 
  filter(response_time_since_previous < 1*30*1000, response_time_since_previous > 0) %>% 
  group_by(item_name) %>% 
  mutate(group_mean = mean(response_time_since_previous, na.rm = TRUE),
         day = if_else(first_day_of_item_shown, if_else(first_day == 1, 
                       "first item, \nfirst day", "first item, \nlater day"), "later day")) %>%
  group_by(item_name, day) %>% 
  filter(n_nonmissing(response_time_since_previous) > 20) %>% 
  ggplot(., aes(day, response_time_since_previous)) + 
  geom_hline(aes(yintercept = group_mean, group = label), color = "gray", linetype = 'dashed') +
  geom_pointrange(position = position_dodge(width = 0.2), stat = 'summary', fun.data = 'mean_se') + 
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = "free_y")
```


### Time series by first day item shown (complete 1st week)
Here, only with those who didn't miss a day in the first week (ruling out selective dropout as an explanation).

```{r}
first_page %>% 
  filter(day_number < 7, didntmissfirstweek == TRUE) %>% 
  group_by(item_name) %>% 
  mutate(group_mean = mean(answer, na.rm = TRUE)) %>% 
  group_by(item_name, day_number, first_day_of_item_factor) %>% 
  filter(n_nonmissing(answer) > 20) %>% 
  ggplot(., aes(day_number, answer, colour = first_day_of_item_factor)) + 
  geom_hline(aes(yintercept = group_mean, group = label), color = "gray", linetype = 'dashed') +
  geom_pointrange(position = position_dodge(width = 0.2), stat = 'summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat = 'summary', fun.data = 'mean_se') + 
  scale_color_colorblind("First day the\nitem was shown") +
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = "free_y") + 
  scale_x_continuous("Day number", breaks = 0:10)
```

```{r}
first_page %>% 
  filter(day_number < 11, didntmissfirstweek == TRUE) %>% 
  group_by(item_name) %>% 
  mutate(group_mean = mean(answer, na.rm = TRUE)) %>% 
  group_by(item_name, day_number, first_day_of_item_factor) %>% 
  filter(n_nonmissing(answer) > 20) %>% 
  ggplot(., aes(day_number, answer, colour = first_day_of_item_factor)) + 
  geom_hline(aes(yintercept = group_mean, group = label), color = "gray", linetype = 'dashed') +
  geom_pointrange(position = position_dodge(width = 0.2), stat='summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat='summary', fun.data = 'mean_se') + 
  scale_color_colorblind("First day the\nitem was shown") +
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = "free_y") + 
  scale_x_continuous("Day number", breaks = 0:10)
```

## Times item shown
```{r}
first_page %>%
  group_by(item_name, times_item_answered) %>% 
  filter(n() > 200) %>% 
  ggplot(., aes(times_item_answered, answer)) + 
  geom_pointrange(position = position_dodge(width = 0.2), stat ='summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat ='summary', fun.data = 'mean_se') + 
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = "free_y")



first_page %>%
  filter(didntmissfirstweek == T, day_number < 8, times_item_answered < 8) %>% 
  filter(response_time_since_previous < 30*1000, response_time_since_previous > 0) %>% 
  ggplot(., aes(times_item_answered, answer)) + 
  geom_pointrange(position = position_dodge(width = 0.2), stat ='summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat ='summary', fun.data = 'mean_se') + 
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = "free_y")
```


## Display order
```{r}
first_page %>%
  ggplot(., aes(display_order, answer)) + 
  geom_pointrange(position = position_dodge(width = 0.2), stat = 'summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat = 'summary', fun.data = 'mean_se') + 
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = 'free_y')

# first_page %>% filter(time_to_response < 1*60*1000) %>% 
#   ggplot(., aes(display_order, time_to_response)) + 
#   geom_pointrange(position = position_dodge(width = 0.2), stat ='summary', fun.data = 'median_hilow') + 
#   geom_line(position = position_dodge(width = 0.4), stat ='summary', fun.data = 'median_hilow') + 
#   scale_y_continuous("Response time") +
#   facet_wrap(~ label_english)


first_page %>% filter(response_time_since_previous < 1*30*1000, response_time_since_previous > 0, display_order > 1) %>% 
  ggplot(., aes(display_order, response_time_since_previous)) + 
  geom_pointrange(alpha = 0.3, position = position_dodge(width = 0.2), stat ='summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat ='summary', fun.y = function(x) { mean(x, na.rm =T, trim = 0.1) }) +
  scale_y_continuous("Response time since previous item") +
  facet_wrap(~ label_english, scales = 'free_y')
```


## Number of items shown
```{r}
first_page %>% 
  ggplot(., aes(number_of_items_shown, answer)) + 
  geom_pointrange(position = position_dodge(width = 0.2), stat ='summary', fun.data = 'mean_se') + 
  # geom_line(position = position_dodge(width = 0.4), stat ='summary', fun.data = 'median_hilow') + 
  scale_y_continuous("Response") +
  facet_wrap(~ label_english, scales = 'free_y')


first_page %>% filter(response_time_since_previous < 1*30*1000, response_time_since_previous > 0, display_order > 1) %>% 
  ggplot(., aes(number_of_items_shown, response_time_since_previous)) + 
  geom_pointrange(alpha = 0.3, position = position_dodge(width = 0.2), stat ='summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat ='summary', fun.y = function(x) { mean(x, na.rm =T, trim = 0.1) }) +
  scale_y_continuous("Response time since previous item") +
  facet_wrap(~ label_english, scales = 'free_y')
```


## Day number
```{r}
first_page %>% filter(response_time_since_previous < 1*30*1000, response_time_since_previous > 0, display_order > 1) %>% 
  ggplot(., aes(day_number, response_time_since_previous)) + 
  geom_pointrange(alpha = 0.3, position = position_dodge(width = 0.2), stat ='summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat ='summary', fun.y = function(x) { mean(x, na.rm =T, trim = 0.1) }) +
  scale_y_continuous("Response time since previous item (10% trimmed)") +
  facet_wrap(~ label_english)

first_page %>% 
  filter(day_number < 11, response_time_since_previous < 30*1000, response_time_since_previous > 0) %>% 
  group_by(item_name) %>% 
  mutate(group_mean = mean(answer, na.rm = TRUE)) %>% 
  group_by(item_name, day_number, first_day_of_item_factor) %>% 
  filter(n_nonmissing(answer) > 20) %>% 
  ggplot(., aes(day_number, response_time_since_previous, colour = first_day_of_item_factor)) + 
  geom_pointrange(alpha = 0.3, position = position_dodge(width = 0.2), stat ='summary', fun.data = 'mean_se') + 
  geom_line(position = position_dodge(width = 0.4), stat ='summary', fun.y = function(x) { mean(x, na.rm =T, trim = 0.1) }) +
  scale_color_colorblind("First day the\nitem was shown") +
  scale_y_continuous("Response time since previous item") +
  facet_wrap(~ label_english)
```



## Multilevel analysis 


```{r}
library(lme4)
library(purrr)
library(DT)
tidy_dt <- . %>% 
  map(tidy) %>% 
  bind_rows(.id = "response") %>% 
  datatable(rownames = FALSE, filter = "top", options = list( pageLength = 200)) %>% 
  formatRound(c("estimate", "std.error", "statistic"), digits = 2) %>% 
  formatRound(c("df"), digits = 0) %>% 
  formatSignif(c("p.value"), digits = 5)
```

### Basic model
adjusting for day number (0 to 7+), random effect for which day the item was first shown, the day number, the user.

```{r}
first_page %>% 
  split(.$item_name) %>%
  map(~ lmer(answer ~ day_number_factor + first_day_of_item_shown + (1 | first_day_of_item_factor) +  (1 | day_number) + (1 | session), data = .)) %>% 
  tidy_dt()

```

#### only those who didn't miss first week

```{r}
first_page %>% 
    filter(didntmissfirstweek == T) %>% 
    split(.$item_name) %>%
    map(~ lmer(answer ~ day_number_factor + first_day_of_item_shown + (1 | first_day_of_item_factor) +  (1 | day_number) + (1 | session), data = .)) %>% 
    tidy_dt()
```

### Model comparison approach
Does adding a first day of item shown effect improve upon a model which has random effects for which day the item was first shown, the day number, the user.

```{r}
first_page %>% 
  filter(didntmissfirstweek == T) %>% 
  split(.$item_name) %>%
  map(~ anova(lmer(answer ~ (1 | first_day_of_item_factor) +  (1 | day_number) + (1 | session), data = ., REML = FALSE),
              lmer(answer ~ first_day_of_item_shown + (1 | first_day_of_item_factor) +  (1 | day_number) + (1 | session), data = ., REML = FALSE)))

```

### First day model
adjusting for first day, random effect for which day the item was first shown, the day number, the user.

```{r}
first_page %>% 
  filter(didntmissfirstweek == T) %>% 
  split(.$item_name) %>%
  map(~ lmer(answer ~ first_day + first_day_of_item_shown + refer_time_period + (1 | first_day_of_item_factor) +  (1 | day_number) + (1 | session), data = .)) %>% 
  tidy_dt()
```

### Continuous items shown model
Testing the times the item was seen already (reference category: first day) as a factor variable, rather than yes/no.

adjusting for day number (0 to 7+), the time period referred to (affected by how often people have responded so far), random effects for which day the item was first shown, the day number, the user.

```{r fig.width=10,fig.height=8}
continuous_mods <- first_page %>% 
  split(.$item_name) %>%
  map(~ lmer(answer ~ times_item_answered_factor + day_number_factor + refer_time_period + (1 | first_day_of_item_factor) + (1 | day_number) + (1 | session), data = .))

. <- first_page
continuous_mods %>% 
  iwalk(~ plot(allEffects(.x), ylab = .y))

continuous_mods %>% 
  tidy_dt()
```

### Complex model
Three randomised effects:

- display order
- number of items shown
- the times the item was seen already (reference category: first day)

adjusting for day number (0 to 7+), the time period referred to (affected by how often people have responded so far), random effects for which day the item was first shown, the day number, the user.

```{r fig.width=10,fig.height=8}
complex_mods <- first_page %>% 
  split(.$item_name) %>%
  map(~ lmer(answer ~ number_of_items_shown + display_order + times_item_answered_factor + day_number_factor + refer_time_period + (1 | first_day_of_item_factor) + (1 | day_number) + (1 | session), data = .))

complex_mods %>% 
  iwalk(~ plot(allEffects(.x), ylab = .y))

complex_mods %>% 
  tidy_dt()

complex_mods <- first_page %>% 
  filter(didntmissfirstweek == T) %>% 
  split(.$item_name) %>%
  map(~ lmer(answer ~ number_of_items_shown + display_order + times_item_answered_factor + day_number_factor + refer_time_period + (1 | first_day_of_item_factor) + (1 | day_number) + (1 | session), data = .))

complex_mods %>% 
  iwalk(~ plot(allEffects(.x), ylab = .y))

complex_mods %>% 
  tidy_dt()

complex_mods %>% walk(~ print(summary(.)))
```


## Multilevel models response time

### Continuous items shown model
Testing the times the item was seen already (reference category: first day) as a factor variable, rather than yes/no.

adjusting for day number (0 to 7+), the time period referred to (affected by how often people have responded so far), random effects for which day the item was first shown, the day number, the user.

```{r fig.width=10,fig.height=8}
first_page <- first_page %>% 
  filter(response_time_since_previous < 30*1000, response_time_since_previous > 0)

. <- first_page
continuous_mods <- first_page %>% 
  split(.$item_name) %>%
  map(~ lmer(response_time_since_previous ~ times_item_answered_factor + day_number_factor + refer_time_period + (1 | first_day_of_item_factor) + (1 | day_number) + (1 | session), data = .))

continuous_mods %>% 
  iwalk(~ plot(allEffects(.x), ylab = .y))

continuous_mods %>% 
  tidy_dt()
```

### Complex model
Three randomised effects:

- display order
- number of items shown
- the times the item was seen already (reference category: first day)

adjusting for day number (0 to 7+), the time period referred to (affected by how often people have responded so far), random effects for which day the item was first shown, the day number, the user.

```{r fig.width=10,fig.height=8}
complex_mods <- first_page %>% 
  split(.$item_name) %>%
  map(~ lmer(response_time_since_previous ~ number_of_items_shown + display_order + times_item_answered_factor + day_number_factor + refer_time_period + (1 | first_day_of_item_factor) + (1 | day_number) + (1 | session), data = .))

complex_mods %>% 
  iwalk(~ plot(allEffects(.x), ylab = .y))

complex_mods %>% 
  tidy_dt()

complex_mods <- first_page %>% 
  filter(didntmissfirstweek == T) %>% 
  split(.$item_name) %>%
  map(~ lmer(response_time_since_previous ~ number_of_items_shown + display_order + times_item_answered_factor + day_number_factor + refer_time_period + (1 | first_day_of_item_factor) + (1 | day_number) + (1 | session), data = .))

complex_mods %>% 
  iwalk(~ plot(allEffects(.x), ylab = .y))

complex_mods %>% 
  tidy_dt()

complex_mods %>% walk(~ print(summary(.)))
```


## Mediation by response time in complex model
Does response time mediate any effects in the complex model?

```{r fig.width=10,fig.height=8}
complex_mods <- first_page %>% 
  split(.$item_name) %>%
  map(~ lmer(answer ~ poly(response_time_since_previous, 3) + number_of_items_shown + display_order + times_item_answered_factor + day_number_factor + refer_time_period + (1 | first_day_of_item_factor) + (1 | day_number) + (1 | session), data = .))

complex_mods %>% 
  iwalk(~ plot(allEffects(.x), ylab = .y))

complex_mods %>% 
  tidy_dt()

complex_mods <- first_page %>% 
  filter(didntmissfirstweek == T) %>% 
  split(.$item_name) %>%
  map(~ lmer(answer ~ poly(response_time_since_previous, 3) + number_of_items_shown + display_order + times_item_answered_factor + day_number_factor + refer_time_period + (1 | first_day_of_item_factor) + (1 | day_number) + (1 | session), data = .))

complex_mods %>% 
  iwalk(~ plot(allEffects(.x), ylab = .y))

complex_mods %>% 
  tidy_dt()

complex_mods %>% walk(~ print(summary(.)))
```
